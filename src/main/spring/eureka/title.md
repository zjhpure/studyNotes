## 公众号(纯洁编程说：chunjie_tech)

## eureka注册中心

什么是Eureka？

Eureka作为SpringCloud的服务注册功能服务器，他是服务注册中心，系统中的其他服务使用Eureka的客户端将其连接到Eureka Service中，并且保持心跳，这样工作人员可以通过Eureka Service来监控各个微服务是否运行正常。

Eureka和ZooKeeper都可以提供服务注册与发现的功能，说说两个的区别：

1、ZooKeeper保证的是CP，Eureka保证的是AP。

2、ZooKeeper有Leader和Follower角色，Eureka各个节点平等。

3、ZooKeeper在选举期间注册服务瘫痪，虽然服务最终会恢复，但是选举期间不可用的。

4、ZooKeeper采用过半数存活原则，Eureka采用自我保护机制解决分区问题。

5、Eureka各个节点是平等关系，只要有一台Eureka就可以保证服务可用。

6、Eureka可以很好的应对因网络故障导致部分节点失去联系的情况，而不会像ZooKeeper一样使得整个注册系统瘫痪。

7、Eureka本质上是一个工程，而ZooKeeper只是一个进程。

8、Eureka保证可用性，实现最终一致性；Zookeeper优先保证一致性的前提下，才会顾及到可用性。

Eureka：
Eureka各个节点都是平等的，几个节点挂掉不会影响正常节点的工作，剩余的节点依然可以提供注册和查询服务。
而Eureka的客户端在向某个Eureka注册或时如果发现连接失败，则会自动切换至其它节点，只要有一台Eureka还在，就能保证注册服务可用(保证可用性)，只不过查到的信息可能不是最新的(不保证强一致性)，Eureka不满足强一致性，但会保证最终一致性。

ZooKeeper：
zookeeper在选举leader时，会停止服务，直到选举成功之后才会再次对外提供服务，这个时候就说明了服务不可用，但是在选举成功之后，因为一主多从的结构，Zookeeper在这时还是一个高可用注册中心，只是在优先保证一致性的前提下，Zookeeper才会顾及到可用性。

CAP定理：

CAP定理是分布式系统领域非常著名的一个定理，它指出对于一个分布式计算系统来说，不可能同时满足以下三点：

C：一致性(Consistence)，等同于所有节点访问同一份最新的数据副本）
A：可用性(Availability)，每次请求都能获取到非错的响应——但是不保证获取的数据为最新数据）
P：分区容错性(Partition tolerance)，以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择

Eureka自我保护机制：

如果在15分钟内超过85%的客户端节点都没有正常的心跳，那么Eureka就认为客户端与注册中心出现了网络故障，Eureka Server自动进入自我保护机制。

此时会出现以下几种情况：
 
1、Eureka Server不再从注册列表中移除因为长时间没收到心跳而应该过期的服务。
2、Eureka Server仍然能够接受新服务的注册和查询请求，但是不会被同步到其它节点上，保证当前节点依然可用。
3、当网络稳定时，当前Eureka Server新的注册信息会被同步到其它节点中。